{"version":3,"file":"js/519.8b5baf96.js","mappings":"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","sources":["webpack://vue-forum/./src/views/TopicView.vue","webpack://vue-forum/src/views/TopicView.vue","webpack://vue-forum/./src/views/TopicView.vue?1b46","webpack://vue-forum/./src/views/TopicView.vue?4bab"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return (_vm.topic)?_c('div',{staticClass:\"topic\"},[_c('div',{staticClass:\"topic-head\"},[_c('div',{staticClass:\"head-top\"},[_c('div',{staticClass:\"top-rigth\"},[(_vm.topic.top || _vm.topic.good)?_c('el-tag',{attrs:{\"size\":\"mini\",\"effect\":\"dark\",\"type\":\"success\"}},[_vm._v(_vm._s(_vm.topic.top ? \"置顶\" : \"精华\"))]):_vm._e(),_c('h2',[_vm._v(_vm._s(_vm.topic.title))])],1),(_vm.accesstoken)?_c('el-button',{attrs:{\"type\":\"success\",\"size\":\"mini\",\"round\":\"\"},on:{\"click\":_vm.collect}},[_vm._v(_vm._s(_vm.topic.is_collect ? \"取消收藏\" : \"收藏\"))]):_vm._e()],1),_c('span',[_c('span',{staticClass:\"iconfont icon-dian1\"}),_vm._v(\"发布于\"+_vm._s(_vm._f(\"fromNow\")(_vm.topic.create_at)))]),_c('span',[_c('span',{staticClass:\"iconfont icon-dian1\"}),_vm._v(\"作者\"+_vm._s(_vm.topic.author.loginname))]),_c('span',[_c('span',{staticClass:\"iconfont icon-dian1\"}),_vm._v(_vm._s(_vm.topic.visit_count)+\"次浏览\")]),_c('span',[_c('span',{staticClass:\"iconfont icon-dian1\"}),_vm._v(\"来自\"+_vm._s(_vm._f(\"tabTextTransform\")(_vm.topic.tab)))])]),_c('div',{staticClass:\"topic-content\",domProps:{\"innerHTML\":_vm._s(_vm.topic.content)}}),(_vm.topic.replies.length)?_c('div',{staticClass:\"comment-box\"},[_c('div',{staticClass:\"comment-head\"},[_c('span',[_vm._v(_vm._s(_vm.topic.replies.length)+\"回复\")])]),_c('div',{staticClass:\"comment-list\"},_vm._l((_vm.topic.replies),function(comment,index){return _c('div',{key:comment.id,class:[\n          'comment-item',\n          { active: _vm.commentLikeMost.includes(comment.id) },\n        ]},[_c('img',{attrs:{\"src\":comment.author.avatar_url,\"alt\":\"\"}}),_c('div',{staticClass:\"comment-content\"},[_c('div',{staticClass:\"info\"},[_c('span',[_c('span',[_vm._v(_vm._s(comment.author.loginname))]),_c('span',[_vm._v(_vm._s(index + 1)+\"楼\")]),_c('span',[_vm._v(_vm._s(_vm._f(\"fromNow\")(comment.create_at)))])]),(comment.ups.length || _vm.accesstoken)?_c('span',[_c('span',{class:['iconfont', 'icon-icon',{up:comment.is_uped}],on:{\"click\":function($event){return _vm.like(comment)}}}),(comment.ups.length)?_c('span',[_vm._v(_vm._s(comment.ups.length))]):_vm._e()]):_vm._e()]),_c('span',{staticClass:\"text\",domProps:{\"innerHTML\":_vm._s(comment.content)}})])])}),0)]):_vm._e(),(_vm.accesstoken)?_c('BasePanel',{scopedSlots:_vm._u([{key:\"panel-head\",fn:function(){return [_vm._v(\" 添加回复 \")]},proxy:true},{key:\"panel-content\",fn:function(){return [_c('div',{staticClass:\"reply-wrap\"},[_c('textarea',{directives:[{name:\"model\",rawName:\"v-model.trim\",value:(_vm.commentText),expression:\"commentText\",modifiers:{\"trim\":true}}],staticClass:\"text-box\",domProps:{\"value\":(_vm.commentText)},on:{\"input\":function($event){if($event.target.composing)return;_vm.commentText=$event.target.value.trim()},\"blur\":function($event){return _vm.$forceUpdate()}}}),_c('el-button',{attrs:{\"type\":\"primary\",\"size\":\"small\"},on:{\"click\":_vm.replied}},[_vm._v(\"回复\")])],1)]},proxy:true}],null,false,1997915439)}):_vm._e()],1):_vm._e()\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\r\n  <div class=\"topic\" v-if=\"topic\">\r\n    <div class=\"topic-head\">\r\n      <div class=\"head-top\">\r\n        <div class=\"top-rigth\">\r\n          <el-tag\r\n            v-if=\"topic.top || topic.good\"\r\n            size=\"mini\"\r\n            effect=\"dark\"\r\n            type=\"success\"\r\n            >{{ topic.top ? \"置顶\" : \"精华\" }}</el-tag\r\n          >\r\n          <h2>{{ topic.title }}</h2>\r\n        </div>\r\n        <el-button\r\n          v-if=\"accesstoken\"\r\n          @click=\"collect\"\r\n          type=\"success\"\r\n          size=\"mini\"\r\n          round\r\n          >{{ topic.is_collect ? \"取消收藏\" : \"收藏\" }}</el-button\r\n        >\r\n      </div>\r\n      <span\r\n        ><span class=\"iconfont icon-dian1\"></span>发布于{{\r\n          topic.create_at | fromNow\r\n        }}</span\r\n      >\r\n      <span\r\n        ><span class=\"iconfont icon-dian1\"></span>作者{{\r\n          topic.author.loginname\r\n        }}</span\r\n      >\r\n      <span\r\n        ><span class=\"iconfont icon-dian1\"></span\r\n        >{{ topic.visit_count }}次浏览</span\r\n      >\r\n      <span\r\n        ><span class=\"iconfont icon-dian1\"></span>来自{{\r\n          topic.tab | tabTextTransform\r\n        }}</span\r\n      >\r\n    </div>\r\n    <div class=\"topic-content\" v-html=\"topic.content\"></div>\r\n\r\n    <div class=\"comment-box\" v-if=\"topic.replies.length\">\r\n      <div class=\"comment-head\">\r\n        <span>{{ topic.replies.length }}回复</span>\r\n      </div>\r\n      <div class=\"comment-list\">\r\n        <div\r\n          :class=\"[\r\n            'comment-item',\r\n            { active: commentLikeMost.includes(comment.id) },\r\n          ]\"\r\n          v-for=\"(comment, index) in topic.replies\"\r\n          :key=\"comment.id\"\r\n        >\r\n          <img :src=\"comment.author.avatar_url\" alt=\"\" />\r\n          <div class=\"comment-content\">\r\n            <div class=\"info\">\r\n              <span\r\n                ><span>{{ comment.author.loginname }}</span>\r\n                <span>{{ index + 1 }}楼</span>\r\n                <span>{{ comment.create_at | fromNow }}</span></span\r\n              >\r\n              <span v-if=\"comment.ups.length || accesstoken\">\r\n                <span @click=\"like(comment)\" :class=\"['iconfont', 'icon-icon',{up:comment.is_uped}]\"></span>\r\n                <span v-if=\"comment.ups.length\">{{ comment.ups.length }}</span>\r\n              </span>\r\n            </div>\r\n            <span class=\"text\" v-html=\"comment.content\"></span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n    </div>\r\n    <BasePanel v-if=\"accesstoken\">\r\n      <template #panel-head>\r\n        添加回复\r\n      </template>\r\n      <template #panel-content>\r\n        <div class=\"reply-wrap\">\r\n          <textarea class=\"text-box\" v-model.trim=\"commentText\"></textarea>\r\n          <el-button type=\"primary\" size=\"small\" @click=\"replied\">回复</el-button>\r\n        </div>\r\n      </template>\r\n    </BasePanel>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport BasePanel from '../components/layout/BasePanel.vue';\r\nimport { getTopic, collected, de_collected, liked,reply } from \"../plugins/api\";\r\nexport default {\r\n  components: { BasePanel },\r\n  props: [\"topicId\"],\r\n  data() {\r\n    return {\r\n      topic: null,\r\n      accesstoken: '',\r\n      commentText: ''\r\n    };\r\n  },\r\n  computed: {\r\n    // 文章评论数组中 点赞前二 的评论\r\n    commentLikeMost() {\r\n      if (this.topic.replies.length === 0) {\r\n        return [];\r\n      }\r\n      const arr = this.topic.replies\r\n        .slice(0)\r\n        .sort((a, b) => b.ups.length - a.ups.length);\r\n      const commentIds = [];\r\n      const maxOne = arr[0].ups.length;\r\n      if (maxOne > 2) {\r\n        const oneArr = arr.filter((item) => item.ups.length === maxOne);\r\n        oneArr.forEach((comment) => {\r\n          commentIds.push(comment.id);\r\n        });\r\n        const maxTwo = arr[oneArr.length].ups.length;\r\n        if (maxTwo > 2) {\r\n          const twoArr = arr.filter((item) => item.ups.length === maxTwo);\r\n          twoArr.forEach((comment) => {\r\n            commentIds.push(comment.id);\r\n          });\r\n        }\r\n      }\r\n      return commentIds;\r\n    },\r\n  },\r\n  async created() {\r\n    const accesstoken = sessionStorage.getItem(\"accesstoken\");\r\n    if (accesstoken) {\r\n      this.accesstoken = accesstoken;\r\n    }\r\n    const res = await getTopic(this.topicId, accesstoken || null);\r\n    this.topic = res.data;\r\n  },\r\n  methods: {\r\n    async collect() {\r\n      const accesstoken = this.accesstoken;\r\n      if (this.topic.is_collect) {\r\n        await de_collected(this.topic.id, accesstoken);\r\n        this.topic.is_collect = false;\r\n      } else {\r\n        await collected(this.topic.id, accesstoken);\r\n        this.topic.is_collect = true;\r\n      }\r\n    },\r\n    async like(comment) {\r\n      // 不能对自己的评论点赞\r\n      const accesstoken = this.accesstoken;\r\n      if (accesstoken) {\r\n        const res = await liked(comment.id, accesstoken);\r\n        const id = JSON.parse(sessionStorage.getItem(\"userInfo\")).id;\r\n        if (res.action === \"up\") {\r\n          // 点赞成功\r\n          // 修改对应评论的 is_uped 及 ups\r\n          comment.is_uped = true;\r\n          comment.ups.push(id);\r\n        } else {\r\n          // 取消点赞成功\r\n          // 修改对应评论的 is_uped 及 ups\r\n          comment.is_uped = false;\r\n          comment.ups.filter((item) => item !== id);\r\n        }\r\n      }\r\n    },\r\n    async replied(){\r\n      const {topic,accesstoken,commentText} = this\r\n      if(commentText){\r\n        await reply(topic.id,accesstoken,commentText)\r\n        // 评论请求成功之后，后端返回的信息太少，无法用来更新本地\r\n        // 所以，重新请求整个文章数据来实现更新\r\n        const res = await getTopic(this.topicId,accesstoken)\r\n        this.topic = res.data\r\n        this.commentText = ''\r\n      }\r\n    }\r\n  },\r\n};\r\n</script>\r\n\r\n<style lang='less'>\r\n.topic {\r\n  width: 1400px;\r\n  margin: 0 auto;\r\n  margin-top: 15px;\r\n  border-radius: 10px;\r\n  background-color: #fff;\r\n  min-height: 100vh;\r\n  .topic-head {\r\n    height: 100px;\r\n    padding: 15px;\r\n    border-bottom: 1px solid rgb(226, 225, 225);\r\n    .head-top {\r\n      display: flex;\r\n      align-items: center;\r\n      justify-content: space-between;\r\n      margin-bottom: 10px;\r\n      .el-tag {\r\n        margin-right: 10px;\r\n      }\r\n    }\r\n    > span {\r\n      font-size: 12px;\r\n      color: #666;\r\n      margin-left: 5px;\r\n      .iconfont {\r\n        font-size: 12px;\r\n      }\r\n    }\r\n  }\r\n  .topic-content {\r\n    width: 1400px;\r\n    margin: 0 auto;\r\n    border-radius: 10px;\r\n    overflow: hidden;\r\n    margin-bottom: 15px;\r\n    p {\r\n      line-height: 1.5;\r\n      img {\r\n        max-width: 100%;\r\n      }\r\n    }\r\n    ol {\r\n      padding-left: 20px;\r\n    }\r\n  }\r\n  .comment-box {\r\n    width: 100%;\r\n    margin-top: 30px;\r\n    overflow: hidden;\r\n    background-color: #fff;\r\n    border-radius: 10px;\r\n    .comment-head {\r\n      height: 50px;\r\n      line-height: 50px;\r\n      padding-left: 15px;\r\n      border-bottom: 1px solid rgb(228, 227, 227);\r\n      background-color: rgb(226, 224, 224);\r\n    }\r\n    .comment-list {\r\n      margin-top: 5px;\r\n      .comment-item {\r\n        padding: 10px;\r\n        border-bottom: 1px solid #ccc;\r\n        display: flex;\r\n        align-items: start;\r\n        img {\r\n          margin-left: 10px;\r\n          margin-right: 10px;\r\n          border-radius: 5px;\r\n          width: 40px;\r\n        }\r\n        .comment-content {\r\n          .info {\r\n            width: 1300px;\r\n            font-size: 14px;\r\n            margin-bottom: 5px;\r\n            display: flex;\r\n            justify-content: space-between;\r\n            .iconfont.up{\r\n              color: red;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      .comment-item.active {\r\n        background-color: #f4fcf0;\r\n      }\r\n    }\r\n  }\r\n  .reply-wrap{\r\n    min-height: 260px;\r\n    .text-box{\r\n      display: block;\r\n      width: 1400px;\r\n      min-height: 200px;\r\n      resize: none;\r\n      margin: 0 auto;\r\n      border: unset;\r\n      outline: none;\r\n      padding: 15px;\r\n      font-size: 16px;\r\n    }\r\n    .el-button{\r\n      margin-left: 15px;\r\n    }\r\n  }\r\n}\r\n</style>","import mod from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./TopicView.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./TopicView.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./TopicView.vue?vue&type=template&id=20157696&\"\nimport script from \"./TopicView.vue?vue&type=script&lang=js&\"\nexport * from \"./TopicView.vue?vue&type=script&lang=js&\"\nimport style0 from \"./TopicView.vue?vue&type=style&index=0&id=20157696&prod&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","topic","staticClass","top","good","attrs","_v","_s","_e","title","accesstoken","on","collect","is_collect","_f","create_at","author","loginname","visit_count","tab","domProps","content","replies","length","_l","comment","index","key","id","class","active","commentLikeMost","includes","avatar_url","ups","up","is_uped","$event","like","scopedSlots","_u","fn","proxy","directives","name","rawName","value","commentText","expression","modifiers","target","composing","trim","$forceUpdate","replied","staticRenderFns","components","BasePanel","props","data","computed","slice","sort","oneArr","commentIds","twoArr","methods","component"],"sourceRoot":""}